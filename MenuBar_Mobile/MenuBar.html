<style>
  .bottom-nav-original,
  .bottom-nav-button,
  .bottom-nav-img {
    display: none;
  }
  #bottom-nav-search-autocomplete li {
    font-size: 14px;
  }
  #bottom-nav-search-autocomplete li .qs-option-name {
    margin-left: 6px;
  }

  .bottomNavHidden {
    visibility: hidden;
    transition: ease-in-out 0.2s;
    transform: translateY(100%);
  }
  .bottomNavActive {
    visibility: visible;
    transition: ease-in-out 0.2s;
    transform: translateY(0);
  }

  @media (max-width: 767px) {
    .bottom-nav-original {
      display: flex;
      flex-flow: row nowrap;
      align-items: center;
      justify-content: center;
      height: 56px;
      width: 100%;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      box-shadow: 0 -2px 10px 0 rgba(0, 0, 0, 0.16),
        0 -1px 5px 0 rgba(0, 0, 0, 0.26);
      z-index: 3147483646;
      background-color: #000 !important;
      margin-bottom: 0px;
    }

    .bottom-nav-button {
      display: block;
      white-space: nowrap;
      user-select: none;
      border: 1px solid transparent !important;
      padding: 0 0.75rem;
      font-size: 0.875rem;
      line-height: 34px;
      height: 36px;
      transition: all 0.15s ease-in-out;
      background-color: #030706 !important;
      color: #1d1d1d;
      cursor: pointer;
      outline: 0;
      position: relative;
    }

    .bottom-nav-original .bottom-nav-button {
      width: auto;
      height: 100%;
      flex-grow: 1;
      flex-basis: 0;
      flex-shrink: 0;
      text-align: center;
      margin: 0;
      border-radius: 0;
      line-height: normal;
    }
    .bottom-nav-button > span {
      margin: 0px;
      padding: 0px;
      border: 0px;
      vertical-align: baseline;
    }

    .bottom-nav-img {
      display: inline;
      height: 3em;
      margin: 0px;
      margin-bottom: 12px;
    }

    .bottom-text {
      position: absolute;
      top: 65%;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
    }
  }
</style>

<div class="bottom-nav bottom-nav-original">
  <button
    class="bottom-nav-button bottom-nav-search mrl-click mm-srch"
    id="bottom-nav-search"
  >
    <span class="icon"
      ><a href="javascript:;">
        <span id="iconPicture">
          <img
            class="bottom-nav-img"
            data-src="https://www.mrliving.com.tw/media/wysiwyg/MenuBar/Buttom_0829/MenuBar_icon_Search_.png"
            alt="搜尋商品"
          />
        </span>
        <p class="bottom-text">搜尋商品</p></a
      >
    </span>
  </button>

  <button class="bottom-nav-button bottom-nav-store mrl-click mm-reserv">
    <span class="icon"
      ><a href="https://www.mrliving.com.tw/store-locations">
        <span id="iconPicture">
          <img
            class="bottom-nav-img"
            data-src="https://www.mrliving.com.tw/media/wysiwyg/MenuBar/Buttom_0829/MenuBar_icon_Shop_.png"
            alt="門市查詢"
          />
        </span>
        <p class="bottom-text">門市查詢</p></a
      >
    </span>
  </button>
  <button class="bottom-nav-button bottom-nav-cart mrl-click mm-cart">
    <span class="icon"
      ><a href="https://www.mrliving.com.tw/checkout/cart/">
        <span id="iconPicture">
          <img
            class="bottom-nav-img"
            data-src="https://www.mrliving.com.tw/media/wysiwyg/MenuBar/Buttom_0829/MenuBar_icon_Cart_.png"
            alt="購物車"
          />
        </span>
        <p class="bottom-text">購物車</p></a
      >
    </span>
  </button>

  <button class="bottom-nav-button bottom-nav-line mrl-click mm-line">
    <span class="icon"
      ><a href="https://maac.io/1snyc" target="_blank">
        <span id="iconPicture">
          <img
            class="bottom-nav-img"
            data-src="https://www.mrliving.com.tw/media/wysiwyg/MenuBar/Buttom_0829/MenuBar_icon_LINE_.png"
            alt="加入Line"
          />
        </span>
        <p class="bottom-text">加入Line</p></a
      >
    </span>
  </button>
</div>

<style>
  #bottom-nav-search-container,
  #bottom-nav-search-container * {
    margin: 0px;
    padding: 0px;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
  }

  #bottom-nav-search-container {
    margin: 0 auto;
    width: 100%;
    height: 100%;
  }

  #bottom-nav-search-container > input {
    display: none;
  }

  #bottom-nav-search-container > label {
    background: #d2d0d0;
    color: #000;
    cursor: pointer;
    display: block;
    float: left;
    font-size: 1em;
    height: 2.5em;
    line-height: 2.5em;
    padding: 0 1.5em;
    text-align: center;
    border-top: #ddd 2px solid;
    border-right: #ddd 2px solid;
    border-left: #ddd 2px solid;
    width: 49%;
  }

  #bottom-nav-search-container #label1 {
    border-top-left-radius: 16px;
    border-right: none;
    white-space: nowrap;
  }

  #bottom-nav-search-container #label2 {
    border-top-right-radius: 16px;
    border-left: none;
    white-space: nowrap;
  }

  #bottom-nav-search-container input:checked + label {
    background: #f9f9f9;
    color: #000;
    position: relative;
    z-index: 6;
  }

  #bottom-nav-search-content {
    background: #f9f9f9;
    min-height: 92%;
    position: relative;
    width: 100%;
    z-index: 5;
    top: 2.5em;
  }

  /*未被選取的狀態*/
  #bottom-nav-search-content > div {
    opacity: 0;
    padding: 0em;
    padding-top: 1.2em;
    position: absolute;
    z-index: -100;
    transition: all ease-in-out 0.1s;
    margin-right: 6px;
    width: 98%;
  }

  #content-catalog p {
    clear: both;
    margin-bottom: 1em;
  }

  #content-store p,
  #content-store .content-store-map {
    padding-left: 22px;
  }

  #bottom-nav-search-container
    input#tab-1:checked
    ~ #bottom-nav-search-content
    #content-catalog,
  #bottom-nav-search-container
    input#tab-2:checked
    ~ #bottom-nav-search-content
    #content-store {
    opacity: 1;
    z-index: 100;
    border-bottom: #ddd 2px solid;
    border-right: #ddd 2px solid;
    border-left: #ddd 2px solid;
    border-bottom-left-radius: 2%;
    border-bottom-right-radius: 2%;
    height: 98%;
    overflow: scroll;
    line-height: 28px;
  }

  #bottom-nav-search-container
    input#tab-1:checked
    ~ #bottom-nav-search-content
    #content-catalog
    * {
    opacity: 1;
    z-index: 100;
  }

  #search_popup {
    display: none;
  }

  #search_popup_01 {
    padding: 20px 15px 25px;
    width: 330px;
    height: 540px;
    overflow: hidden;
  }

  .porto-icon-location:before {
    margin: 0px;
  }

  .bottom-nav-search-button {
    margin: 20px;
    background: #0088cc;
    color: #ffffff;
  }

  .content-catalog-btn {
    width: 100%;
    background-color: #e6e7e7;
    height: 100%;
    border-bottom: solid 2px #dddcdc;
    display: flex;
    align-items: center;
  }

  .content-catalog-btn > button {
    border: 0px;
    background: #e6e7e7;
    width: 100%;
    display: flex;
    justify-content: center;
  }

  .btn-arrow {
    position: relative;
    right: 3%;
    width: 40%;
    text-align: right;
  }

  .btn-text {
    width: 50%;
    text-align: left;
  }

  .content-catalog-all-btn {
    height: 88%;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }

  .bottom-nav-search-button {
    position: absolute;
    top: 5%;
    right: 10%;
    border: 0px;
  }

  .recomd-img {
    width: 100%;
    height: auto;
  }

  #content-store h3 {
    font-size: 20px;
  }

  @media (max-width: 320px) {
    #search_popup_01 {
      width: 280px;
      height: 480px;
    }
  }
</style>

<div
  id="search_popup_01"
  class="newsletter"
  style="display: none; padding: 10px 20px 10px 15px; font-size: larger"
>
  <div id="bottom-nav-search-container">
    <input
      id="tab-1"
      type="radio"
      name="bottom-nav-tab-group"
      checked="checked"
    />
    <label for="tab-1" id="label1">商品搜尋</label>
    <input id="tab-2" type="radio" name="bottom-nav-tab-group" />
    <label for="tab-2" id="label2">熱銷推薦</label>

    <div id="bottom-nav-search-content">
      <div id="content-catalog" style="overflow: hidden">
        <form
          class="form menu-search minisearch"
          id="bottom_menu_search_form"
          action="https://www.mrliving.com.tw/catalogsearch/result/"
          method="get"
        >
          <div class="field search">
            <div class="bottom-nav-search-control control">
              <input
                id="menu-search"
                type="text"
                name="q"
                value=""
                placeholder="皮沙發、北歐風布沙發"
                class="input-text bottom-nav-search-catalog"
                maxlength="128"
                role="combobox"
                aria-haspopup="false"
                aria-autocomplete="both"
                autocomplete="off"
                aria-expanded="false"
                style="
                  padding: 10px;
                  margin-bottom: 16px;
                  margin-left: 10px;
                  margin-right: 10px;
                  width: 93%;
                "
                data-mage-init='{"quickSearch":{"formSelector":"#bottom_menu_search_form","url":"https://www.mrliving.com.tw/search/ajax/suggest/","destinationSelector":"#bottom-nav-search-autocomplete","minSearchLength":2}}'
              />
              <div
                id="bottom-nav-search-autocomplete"
                class="search-autocomplete"
                style="
                  z-index: 6000;
                  position: absolute;
                  top: 58px;
                  left: 50%;
                  transform: translateX(-49.5%);
                "
              ></div>
            </div>
          </div>
          <div class="actions">
            <button
              type="submit"
              title="Search"
              class="action search bottom-nav-search-button"
              aria-label="Search"
              style="border: 0px"
            >
              <i class="porto-icon-search"></i>
            </button>
          </div>
        </form>
        <div class="content-catalog-all-btn">
          <div class="content-catalog-btn">
            <button
              type="button"
              onclick="location.href='https://www.mrliving.com.tw/topsales.html'"
            >
              <div class="btn-text">新品家具推薦</div>
              <div class="btn-arrow">></div>
            </button>
          </div>
          <div class="content-catalog-btn">
            <button
              type="button"
              onclick="location.href='https://www.mrliving.com.tw/stocking-furnitures.html'"
            >
              <div class="btn-text">現貨推薦</div>
              <div class="btn-arrow">></div>
            </button>
          </div>
          <div class="content-catalog-btn">
            <button
              type="button"
              onclick="location.href='https://www.mrliving.com.tw/furniture/livingroom.html'"
            >
              <div class="btn-text">客廳家具</div>
              <div class="btn-arrow">></div>
            </button>
          </div>
          <div class="content-catalog-btn">
            <button
              type="button"
              onclick="location.href='https://www.mrliving.com.tw/furniture/diningroom.html'"
            >
              <div class="btn-text">餐廳家具</div>
              <div class="btn-arrow">></div>
            </button>
          </div>
          <div class="content-catalog-btn">
            <button
              type="button"
              onclick="location.href='https://www.mrliving.com.tw/furniture/bedroom.html'"
            >
              <div class="btn-text">寢室家具</div>
              <div class="btn-arrow">></div>
            </button>
          </div>
          <div class="content-catalog-btn">
            <button
              type="button"
              onclick="location.href='https://www.mrliving.com.tw/furniture/studyroom.html'"
            >
              <div class="btn-text">書房家具</div>
              <div class="btn-arrow">></div>
            </button>
          </div>
          <div class="content-catalog-btn" style="border-bottom: 0px">
            <button
              type="button"
              onclick="location.href='https://www.mrliving.com.tw/furniture/nordic-lighting.html'"
            >
              <div class="btn-text">燈飾</div>
              <div class="btn-arrow">></div>
            </button>
          </div>
        </div>
      </div>
      <div id="content-store" style="padding: 0.7em; padding-top: 1.2em">
        <ul style="list-style: none">
          <li class="content-store-li">
            <a href="https://www.mrliving.com.tw/one-shipfree.html"
              ><img
                class="bottom-nav-img recomd-img"
                data-src="https://www.mrliving.com.tw/media/wysiwyg/MenuBar/Hotsale_mobile_7piece_7.jpg"
                alt="床墊寢具單件免運"
            /></a>
          </li>
          <li class="content-store-li">
            <a href="https://www.mrliving.com.tw/hotsales/mcm-series.html"
              ><img
                class="bottom-nav-img recomd-img"
                data-src="https://www.mrliving.com.tw/media/wysiwyg/MenuBar/file.jpg"
                alt="北歐復古實木家具"
            /></a>
          </li>
          <li class="content-store-li">
            <a
              href="https://www.mrliving.com.tw/sofas/style/sofa-pet-friendly.html"
              ><img
                class="bottom-nav-img recomd-img"
                data-src="https://www.mrliving.com.tw/media/wysiwyg/MenuBar/file_2.jpg"
                alt="防水貓抓布"
            /></a>
          </li>
          <li class="content-store-li">
            <a href="https://www.mrliving.com.tw/sofas/style/leather-sofa.html"
              ><img
                class="bottom-nav-img recomd-img"
                data-src="https://www.mrliving.com.tw/media/wysiwyg/MenuBar/file_1.jpg"
                alt="全牛皮沙發"
            /></a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  // <![CDATA[
  (function () {
    //判斷是否出現
    let currentURL = window.location.href;
    let pageType = document.querySelector(".ga-page")?.value;

    const limitedPages = [
      "checkout/",
      "surveycake.com",
      "appointment-form",
      "pay.mrliving.com.tw",
    ];
    const hideBottomNav = limitedPages.some((keyword) =>
      currentURL.endsWith(keyword)
    );
    const parentBlock = document
      .querySelector(".bottom-nav-original")
      .closest(".block-static-block");
    console.log(parentBlock);
    if (hideBottomNav) {
      if (parentBlock) {
        parentBlock.parentNode.removeChild(parentBlock);
        return;
      }
    } else if (pageType === "product") {
      if (parentBlock) {
        parentBlock.parentNode.removeChild(parentBlock);
        return;
      }
    }
    var iconPicture = document.querySelectorAll("#iconPicture");
    if (window.innerWidth <= 768) {
      for (var i = 0; i < iconPicture.length; i++) {
        var url = iconPicture[i]
          .querySelector(".bottom-nav-img")
          .getAttribute("data-src");
        if (MagefanWebP._canUseWebP) {
          url = url.replace(
            "https://www.mrliving.com.tw/media/",
            "https://www.mrliving.com.tw/media/mf_webp/png/media/"
          );
          url = url.replace(".png", ".webp");
        }
        iconPicture[i].querySelector(".bottom-nav-img").src = url;
      }
    }
    var contentStoreLi = document.querySelectorAll(".content-store-li");
    if (window.innerWidth <= 768) {
      for (var i = 0; i < contentStoreLi.length; i++) {
        var url = contentStoreLi[i]
          .querySelector(".bottom-nav-img")
          .getAttribute("data-src");
        if (MagefanWebP._canUseWebP) {
          url = url.replace(
            "https://www.mrliving.com.tw/media/",
            "https://www.mrliving.com.tw/media/mf_webp/jpg/media/"
          );
          url = url.replace(".jpg", ".webp");
        }
        contentStoreLi[i].querySelector(".bottom-nav-img").src = url;
      }
    }
    require(["jquery", "fancybox"], function ($) {
      $("#bottom-nav-search").on("click", function () {
        mrl_bottom_search("#search_popup_01");
      });

      function mrl_bottom_search(rowpopup) {
        $.fancybox.open({
          src: rowpopup,
          type: "inline",
        });
      }
    });
    // ]]>

    //To prevent origin the form event from mini search form
    var menuSearch = document.querySelector("#menu-search");
    var minisearchLabel = document
      .querySelector("#search_mini_form")
      .querySelector("label");
    var minisearchForm = document.querySelector("#search_mini_form");
    menuSearch.addEventListener("click", menuSearchClick);

    function menuSearchClick() {
      minisearchLabel.classList.remove("active");
      minisearchForm.reset();
    }

    //點擊漢堡時隱藏底部選單
    let hamburgerActive = false;

    document.addEventListener("click", function (e) {
      let bottomNav = document.querySelector(".bottom-nav");
      if (event.target.classList.contains("ninjamenus-top-triggered")) {
        event.stopPropagation();

        hamburgerActive = !hamburgerActive;
        bottomNav.classList.toggle("bottomNavHidden", hamburgerActive);
        bottomNav.classList.toggle("bottomNavActive", !hamburgerActive);
      }
    });
  })();
</script>
